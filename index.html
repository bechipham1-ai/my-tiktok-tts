<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>TTS IDOL B√àO - AI VERSION</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        :root { --main: #fe2c55; --bg: #121212; --panel: #1e1e1e; --ai: #4facfe; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; padding: 20px; display: flex; gap: 20px; height: 100vh; box-sizing: border-box; }
        .column { background: var(--panel); padding: 20px; border-radius: 12px; border: 1px solid #333; display: flex; flex-direction: column; }
        .left { flex: 1.2; border: 1px solid var(--main); } .right { flex: 2; }
        input, button { padding: 12px; margin: 5px 0; border-radius: 8px; border: none; width: 100%; box-sizing: border-box; font-size: 14px; }
        button { background: var(--main); color: white; font-weight: bold; cursor: pointer; }
        .list-box { flex-grow: 1; overflow-y: auto; background: #000; padding: 10px; border-radius: 8px; margin-top: 10px; border: 1px solid #222; }
        .msg { font-size: 13px; border-bottom: 1px solid #222; padding: 8px 0; }
        .setting-row { display: flex; align-items: center; justify-content: space-between; background: #252525; padding: 10px; border-radius: 8px; margin: 5px 0; font-size: 13px; }
        .ai-row { background: linear-gradient(90deg, #fe2c55, var(--ai)); border: none; font-weight: bold; }
        .tab-btn { background: #333; width: 32%; display: inline-block; padding: 10px; border-radius: 8px; cursor: pointer; text-align: center; font-size: 12px; }
        .tab-active { background: var(--main); }
        .switch { position: relative; display: inline-block; width: 34px; height: 18px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #444; border-radius: 18px; transition: .4s; }
        .slider:before { position: absolute; content: ""; height: 12px; width: 12px; left: 3px; bottom: 3px; background-color: white; border-radius: 50%; transition: .4s; }
        input:checked + .slider { background-color: #fff; }
        input:checked + .slider:before { transform: translateX(16px); background-color: var(--main); }
    </style>
</head>
<body>
    <div class="column left">
        <h3 style="color:var(--main); margin-top:0;">üéôÔ∏è B√àO AI CONTROL</h3>
        <input type="text" id="user" placeholder="Nh·∫≠p ID TikTok">
        <button onclick="start()">K·∫æT N·ªêI NGAY</button>
        
        <div class="setting-row ai-row"><span>‚ú® CH·∫æ ƒê·ªò TR·ª¢ L√ù AI:</span><label class="switch"><input type="checkbox" id="aiToggle" onchange="toggleAI(this.checked)"><span class="slider"></span></label></div>
        <div class="setting-row"><span>üîä Ch√†o ng∆∞·ªùi v√†o:</span><label class="switch"><input type="checkbox" id="welcomeToggle" checked><span class="slider"></span></label></div>
        <div class="setting-row"><span>üéÅ C·∫£m ∆°n qu√†:</span><label class="switch"><input type="checkbox" id="giftToggle" checked><span class="slider"></span></label></div>
        <div class="setting-row"><span>üî• Nh·∫Øc PK 20s:</span><label class="switch"><input type="checkbox" id="pkToggle" checked><span class="slider"></span></label></div>
        
        <p id="stt" style="color:#00f2ea; font-size:12px; margin: 10px 0;">Tr·∫°ng th√°i: S·∫µn s√†ng</p>
        <div class="list-box" id="chat"></div>
    </div>

    <div class="column right">
        <div style="margin-bottom: 10px;">
            <div class="tab-btn tab-active" id="btn-ban" onclick="switchTab('ban')">T·ª™ C·∫§M</div>
            <div class="tab-btn" id="btn-acr" onclick="switchTab('acr')">VI·∫æT T·∫ÆT</div>
            <div class="tab-btn" id="btn-emo" onclick="switchTab('emo')">ICON</div>
        </div>
        <div id="tab-ban-ui"><input type="text" id="new-word" placeholder="T·ª´ mu·ªën ch·∫∑n..."><button onclick="addWord()">TH√äM</button><div class="list-box" id="word-list"></div></div>
        <div id="tab-acr-ui" style="display:none;"><input type="text" id="acr-key" placeholder="Vi·∫øt t·∫Øt"><input type="text" id="acr-val" placeholder="ƒê·ªçc th√†nh"><button onclick="addAcr()">TH√äM</button><div class="list-box" id="acr-list"></div></div>
        <div id="tab-emo-ui" style="display:none;"><input type="text" id="emo-icon" placeholder="Icon (vd: ‚ù§Ô∏è)"><input type="text" id="emo-text" placeholder="ƒê·ªçc th√†nh"><button onclick="addEmo()">TH√äM</button><div class="list-box" id="emo-list"></div></div>
    </div>

    <script>
        const socket = io();
        let queue = [], playing = false;

        function switchTab(t) {
            ['ban','acr','emo'].forEach(tab => { 
                document.getElementById(`tab-${tab}-ui`).style.display = tab === t ? 'block' : 'none'; 
                document.getElementById(`btn-${tab}`).classList.toggle('tab-active', tab === t); 
            });
        }

        function toggleAI(status) { socket.emit('toggle-ai', status); }

        async function loadData() {
            const words = await (await fetch('/api/words')).json();
            document.getElementById('word-list').innerHTML = words.map(w => `<div class="msg"><span>${w}</span><span onclick="delWord('${w}')" style="color:red;float:right;cursor:pointer;">X√ìA</span></div>`).join('');
            const acrs = await (await fetch('/api/acronyms')).json();
            document.getElementById('acr-list').innerHTML = acrs.map(a => `<div class="msg"><span>${a.key}‚ûú${a.value}</span><span onclick="delAcr('${a.key}')" style="color:red;float:right;cursor:pointer;">X√ìA</span></div>`).join('');
            const emos = await (await fetch('/api/emojis')).json();
            document.getElementById('emo-list').innerHTML = emos.map(e => `<div class="msg"><span>${e.icon}‚ûú${e.text}</span><span onclick="delEmo('${e._id}')" style="color:red;float:right;cursor:pointer;">X√ìA</span></div>`).join('');
        }

        async function addWord() { await fetch('/api/words', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({word: document.getElementById('new-word').value}) }); loadData(); }
        async function delWord(w) { await fetch(`/api/words/${encodeURIComponent(w)}`, { method: 'DELETE' }); loadData(); }
        async function addAcr() { await fetch('/api/acronyms', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({key: document.getElementById('acr-key').value, value: document.getElementById('acr-val').value}) }); loadData(); }
        async function delAcr(k) { await fetch(`/api/acronyms/${encodeURIComponent(k)}`, { method: 'DELETE' }); loadData(); }
        async function addEmo() { await fetch('/api/emojis', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({icon: document.getElementById('emo-icon').value, text: document.getElementById('emo-text').value}) }); loadData(); }
        async function delEmo(id) { await fetch(`/api/emojis/${id}`, { method: 'DELETE' }); loadData(); }

        function start() { socket.emit('set-username', document.getElementById('user').value); }
        socket.on('status', m => document.getElementById('stt').innerText = 'Tr·∫°ng th√°i: ' + m);
        
        socket.on('audio-data', d => {
            const chat = document.getElementById('chat');
            const div = document.createElement('div'); div.className = 'msg';
            div.innerHTML = `<b style="color:${d.type==='ai'?'#4facfe':'#fe2c55'}">${d.user}:</b> ${d.comment}`;
            chat.prepend(div);
            if (d.audio) {
                if (d.type === 'welcome' && !document.getElementById('welcomeToggle').checked) return;
                if (d.type === 'gift' && !document.getElementById('giftToggle').checked) return;
                if (d.type === 'pk' && !document.getElementById('pkToggle').checked) return;
                queue.push(d.audio); if (!playing) play();
            }
        });

        function play() {
            if (!queue.length) { playing = false; return; }
            playing = true; const a = new Audio(queue.shift());
            a.onended = () => setTimeout(play, 300); a.play().catch(() => play());
        }
        loadData();
    </script>
</body>
</html>
